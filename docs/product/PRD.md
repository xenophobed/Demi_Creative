# 儿童创意工坊 - 产品需求文档 (PRD)

> **定位**: 本文档专注于产品功能定义，技术实现见 [ARCHITECTURE.md](ARCHITECTURE.md)，领域背景见 [DOMAIN.md](DOMAIN.md)

---

## 1. 产品概述

### 1.1 产品定位
儿童创意工坊是一个基于 AI Agent 的创意内容生成平台，为 3-12 岁儿童提供安全、有趣、富有教育意义的内容创作服务。

### 1.2 核心价值主张
- **激发创造力**: AI 将儿童画作转化为生动故事
- **互动参与**: 多分支互动故事，让儿童成为故事的创作者
- **个性化体验**: 记住每个孩子的创作历史，保持故事连续性
- **知识普及**: 双角色早间秀播客将复杂新闻转化为有趣的儿童对话体验
- **安全保障**: 所有内容经过严格审查，符合儿童内容标准

---

## 2. 目标用户

### 2.1 用户画像

**小明 (7岁) - 小画家**
- 喜欢画画，想看到自己的画"活"起来
- 对恐龙、太空、动物感兴趣
- 注意力集中时间：15-20分钟

**李女士 (35岁) - 家长**
- 关注儿童教育和内容安全
- 希望孩子接触有教育意义的内容
- 担心互联网上的不良内容

**张老师 (教师) - 教育工作者**
- 需要有趣的教学素材
- 希望激发学生创造力
- 寻找适合不同年龄段的内容

---

## 3. 核心功能

### 3.1 画作转故事 (Image-to-Story) [Complete]

#### 功能描述
儿童上传画作，AI Agent 分析画作内容，生成个性化故事。

#### 用户场景
```
小明画了一只小狗在公园玩耍
  ↓
上传到系统
  ↓
AI 识别：小狗、树木、太阳、快乐情绪
AI 发现：小明上周也画过这只狗，叫"闪电"
  ↓
生成故事："闪电小狗今天又来到了它最喜欢的公园..."
  ↓
输出：文字故事 + 语音朗读
```

#### 输入
- **必填**: 画作图片 (PNG/JPG, 最大 10MB)
- **可选**: 儿童年龄、兴趣标签

#### 输出
- 故事文本 (200-500字，根据年龄调整)
- 语音朗读 (可选声音：温柔奶奶、调皮小精灵等)
- 教育要点总结

#### 特色功能
- **角色记忆**: 识别重复出现的角色（如"闪电小狗"），保持故事连续性
- **年龄适配**: 3-5岁简短故事（100-200字），6-8岁中等（200-400字），9-12岁更长（400-800字）
- **安全审查**: 自动过滤不适合儿童的内容

---

### 3.2 互动故事生成器 (Interactive Story) [In Progress]

#### 功能描述
基于儿童兴趣生成多分支互动故事，让儿童在关键点做出选择，影响故事走向。

#### 用户场景
```
小红想听恐龙故事
  ↓
AI 生成开篇："小恐龙发现了一个神秘山洞..."
  ↓
展示选择：
  A. 勇敢地走进去 🏔️
  B. 先回家叫上朋友 👫
  ↓
小红选择 A
  ↓
AI 生成下一段："小恐龙走进山洞，发现了发光的化石..."
  ↓
继续 2-4 轮，最终到达结局
  ↓
总结教育要点：勇气、科学探索精神
```

#### 两种模式

**线性模式** (Traditional) [Not Started]
- 一次性生成完整故事
- 适合睡前故事、阅读练习
- 300-800字

**互动模式** (Interactive) [Complete — core flow]
- 分段生成，每段 100-300字
- 2-4 个决策点，每次 2-3 个选项
- 所有分支都是"好结局"（不惩罚儿童的选择）
- SSE streaming for opening and choices
- Age-based audio strategy (audio-first for 3-5, simultaneous for 6-9, text-first for 10-12)
- Preference tracking on story completion
- Save completed stories to My Library

#### 输入
- **必填**: 儿童年龄、兴趣标签（1-5个）
- **可选**: 故事主题、教育目标、互动模式

#### 输出
- 故事段落 + 语音朗读
- 互动选项（含emoji）
- 教育要点总结
- 会话ID（用于多轮对话）

#### 特色功能
- **个性化推荐**: 根据历史偏好调整主题
- **教育融合**: 自然融入 STEAM 和品德教育
- **语言适配**: 根据年龄自动调整词汇和句式复杂度

#### 已实现 (What's Built)
- ✅ Core interactive mode: start → choose → progress → ending
- ✅ SSE streaming for all generation endpoints
- ✅ Age-based configuration (word count, complexity, segment count, audio mode)
- ✅ Safety check integration via MCP tool
- ✅ TTS audio generation with age-appropriate voice/speed
- ✅ Vector search for similar content
- ✅ Preference storage on completion (themes, concepts, interests, choices)
- ✅ Session management (create, track progress, expire)
- ✅ Full frontend: setup → playing → completed states with 2.5D visual effects
- ✅ Story save to My Library on completion
- ✅ Educational summary display with tags

#### Phase 2 增强 (Planned Enhancements)
- 🔲 **偏好感知生成**: 将儿童累积偏好 (themes, concepts, recent_choices) 注入开篇提示词，目前偏好仅在完成时存储但不在创建时读取
- 🔲 **角色延续**: 跨会话搜索和重用重复角色（如"闪电小狗"在互动故事中继续出现），目前仅画作转故事有角色记忆
- 🔲 **主题推荐**: 基于偏好历史推荐故事主题，替代当前的纯手动输入
- 🔲 **会话恢复**: 列出活跃会话并支持中断后继续，后端 `list_sessions` 已存在但无 API 路由暴露
- 🔲 **故事回放**: 重新阅读已完成的互动故事（含完整分支路径），目前保存的仅为拼接文本
- 🔲 **选择特质追踪**: 追踪选择揭示的性格特质（勇气、友谊等），提示词已定义但 Pydantic 模型缺少 `trait` 字段
- 🔲 **线性模式**: 添加一键生成完整故事模式，适合睡前阅读
- 🔲 **故事地图可视化**: 展示选择的分支树，让儿童看到自己的冒险路径
- 🔲 **跨会话故事宇宙**: 引用前次会话中的角色和事件（"还记得上次闪电小狗的冒险吗？"）

#### 已知技术债
- 年龄组定义不一致：PRD 定义 3-5/6-8/9-12，后端枚举包含 6-8 和 6-9 两个重叠组，前端仅显示 3-5/6-9/10-12
- `_should_use_mock()` 在 agent 中重复定义两次
- 开篇和续段的提示词在普通/流式函数间重复，应提取为共享函数
- 保存互动故事时 `safety_score` 硬编码为 0.9，未使用实际安全检查分数
- 互动故事领域缺少契约测试 (`backend/tests/contracts/`)

> **GitHub Epic**: #41 | **Phase**: 2 (core flow complete, enhancements in Phase 2) | **Milestone**: Phase 2 — Interactive + Memory + News

---

### 3.3 儿童新闻早间秀 (Kids Morning Show) [Phase 2]

> 升级原 "新闻儿童化转换器"，从单篇文本转换进化为沉浸式双角色播客体验，配备可视化动画和每日自动推送。保留原有手动转换功能作为"手动模式"。

#### 3.3.1 早间秀对话模式 (Morning Show Dialogue)

##### 功能描述
LLM 将新闻改写为双角色对话剧本："好奇宝宝" (Curious Kid) 提出孩子会问的问题，"趣味专家" (Fun Expert) 用生动的比喻和故事回答。如果儿童在画作转故事或互动故事中创建过重复角色（如"闪电小狗"），该角色可以作为"特邀嘉宾主播"参与对话。

##### 用户场景
```
系统从 SpaceX 新闻生成早间秀：

好奇宝宝：嘿！我听说有人往月球发射了一辆超级大公交车？
趣味专家：没错！科学家们造了一艘巨大的火箭，比30层楼还高！
好奇宝宝：哇，那比我们学校还高！它是怎么飞上去的？
趣味专家：它用了超级强大的发动机，喷出的火焰有蓝色和橙色...
[闪电小狗特邀嘉宾]：汪汪！我也想坐火箭去月球！月球上有骨头吗？
趣味专家：哈哈，月球上没有骨头，但有很多陨石坑...
```

##### 技术实现
- 使用 Claude Agent SDK 生成结构化对话剧本（JSON 格式，标注角色和台词）
- 通过 Memory System 查询儿童重复角色，注入对话作为嘉宾
- 使用 OpenAI TTS 多次调用（不同 voice 参数）生成各角色音频
- 音频拼接为完整播客（前端顺序播放）
- 全部内容通过安全审查（safety_score >= 0.85）

#### 3.3.2 可视化动画体验 (Visual Animatic)

##### 功能描述
播客播放时，屏幕展示 3-4 张 AI 生成的新闻主题插画，配合平移、缩放等 2.5D 动画效果和角色说话时的音频可视化。效果类似视频，但只需要图片+音频的成本。

##### 技术实现
- 基于新闻主题和对话内容生成 3-4 张插画（使用图片生成 API）
- 前端使用 CSS 动画实现平移/缩放（Ken Burns 效果）
- 角色头像在说话时显示音频波形动画
- 插画切换与对话段落同步（通过时间戳标记）

#### 3.3.3 每日推送 (Daily Drop)

##### 功能描述
儿童可以订阅感兴趣的新闻频道（太空、恐龙、动物、机器人等）。系统每日自动生成个性化播客并推送到"我的创作库"。

##### 用户场景
```
家长帮小明订阅了"太空"和"动物"频道
  ↓
系统每天凌晨自动：
  1. 获取最新儿童友好新闻
  2. 生成双角色对话剧本
  3. 渲染多角色音频
  4. 生成配套插画
  5. 打包为完整早间秀
  ↓
小明早上打开 App，"我的创作库"里有新节目等着他
```

##### 技术实现
- 后端定时任务（可配置时间，默认凌晨 2:00）
- 按用户订阅频道批量生成
- 生成结果保存为 story_type = "morning_show"，出现在我的创作库
- 生成失败时跳过该频道，不阻塞其他频道
- 频率限制：每个订阅频道每天最多 1 集

#### 输入
- **自动模式**: 订阅频道 + 儿童年龄 + 偏好记忆（Daily Drop）
- **手动模式**: 新闻 URL/文本 + 年龄（保留原有转换功能）

#### 输出
- 双角色对话剧本（JSON + 可读文本）
- 多角色音频（分段播放，各角色不同语音）
- 3-4 张主题插画（配合 Ken Burns 动画）
- 儿童版标题、为什么重要、关键概念、互动问题（保留原有输出）

#### 年龄适配

| 年龄组 | 节目时长 | 插画数 | 对话风格 | 语音配置 |
|--------|---------|--------|---------|---------|
| 3-5岁  | 1分钟   | 2张    | 好奇宝宝问"为什么"，专家一句话回答 | nova + shimmer, 0.9x 速度, 音频自动播放 |
| 6-8岁  | 2分钟   | 3张    | 好奇宝宝问"怎么"和"如果"，专家用比喻解释 | shimmer + fable, 1.0x 速度, 文字+音频同步 |
| 9-12岁 | 3分钟   | 4张    | 好奇宝宝挑战"但是..."，专家深入分析 | echo + fable, 1.1x 速度, 文字优先+音频切换 |

#### 内容安全要求
- 所有对话剧本通过 `check_content_safety`（safety_score >= 0.85）后才生成 TTS
- 新闻源预过滤：跳过涉及暴力、死亡、战争、性、政治争议、伤亡灾难的文章
- 嘉宾角色对话单独安全检查（用户创建角色可能有意外名称/特征）
- 订阅频道为策划允许列表（NewsCategory 枚举），不支持自由文本
- Daily Drop 包含安全门：生成失败的节目被丢弃，替换为备用趣味知识话题

#### 验收标准
- [ ] 早间秀 Agent 从新闻文章生成双角色对话剧本（好奇宝宝 + 趣味专家）
- [ ] Memory System 集成：儿童重复角色可注入为"特邀嘉宾主播"
- [ ] 多角色 TTS：各角色使用不同语音+语速组合（OpenAI TTS 已有语音）
- [ ] 可视化动画：每集 3-4 张 AI 插画，配合 Ken Burns 平移/缩放动画
- [ ] 角色头像在说话时显示音频波形
- [ ] 频道订阅 CRUD：订阅/取消订阅/列出订阅
- [ ] Daily Drop 定时任务：后台自动为订阅频道生成节目，保存到我的创作库
- [ ] 节目在我的创作库显示为新内容类型 "morning_show"
- [ ] 播放页面支持分屏：插画+对话文本+音频控件+角色头像
- [ ] 首次使用引导：带插画的频道订阅选择向导
- [ ] 偏好追踪：订阅频道和收听完成情况反馈到 Memory System
- [ ] 节目生成延迟：剧本+音频+4张插画 < 60秒（不含队列等待）

#### 边界情况
- **无订阅**: 显示友好引导页："订阅你喜欢的频道，每天醒来就有新节目！"
- **生成失败**: 回退到基础新闻转换文本模式，记录失败日志
- **无可用新闻**: 跳过该频道，用内置趣味知识库生成"小贴士"填充
- **首次使用**: 引导儿童选择 1-3 个订阅频道
- **无重复角色**: 如 Memory System 无儿童角色，使用内置默认角色（如"猫头鹰教授"、"彗星船长"）
- **未认证用户**: 早间秀需认证（订阅是用户专属），未认证用户看样品/预览节目

#### 不在本期范围
- 全 AI 视频生成（使用静态插画 + CSS 动画替代 Sora/Veo）
- 自动新闻爬取/抓取（初版使用策划来源或手动输入）
- 角色语音克隆（嘉宾使用已有 OpenAI TTS 语音，语音克隆为 Phase 3）
- 社交/分享功能（COPPA 隐私考虑）
- 家长分析仪表盘（Phase 3）
- 推送通知（Daily Drop 在库中创建节目，推送需通知服务）
- 背景音乐/音效（TTS epic #45 的声音设计管线单独增强）

> **GitHub Epic**: #44 (升级) | **Phase**: 2 | **Milestone**: Phase 2 — Interactive + Memory + News

---

### 3.4 内容安全系统 (Safety Check) [Complete]

#### 功能描述
对所有生成内容进行自动安全审查，确保符合儿童内容标准。

#### 审查维度

**负面内容过滤** (禁止)
- 暴力：打斗、血腥、武器
- 恐怖：鬼怪、黑暗、惊悚元素
- 不当语言：脏话、侮辱、歧视
- 成人话题：性、毒品、政治争议

**正向价值引导** (鼓励)
- 性别平等：避免刻板印象（医生总是男性）
- 文化多样性：展现不同文化、种族背景
- 品德教育：友谊、勇气、诚实、同理心
- 环保意识：爱护自然、保护动物

#### 输出
- 安全评分 (0.0-1.0)
- 问题列表（如有）
- 修改建议（如有）

#### 安全标准
- 分数 < 0.7：内容不通过，需要修改
- 分数 0.7-0.85：警告，建议修改
- 分数 > 0.85：通过

---

### 3.5 记忆管理系统 (Memory System) [In Progress]

#### 功能描述
记住每个孩子的创作历史和偏好，实现内容连续性。

#### 记忆类型

**角色记忆**
- 识别重复角色：如儿童多次画"闪电小狗"
- 保持一致性："闪电小狗"的特征在不同故事中保持
- 角色成长：随时间推移，角色可以"成长"

**偏好记忆**
- 兴趣追踪：记录儿童喜欢的主题（恐龙、太空等）
- 互动记录：记录儿童在互动故事中的选择偏好
- 学习进度：根据反馈调整内容难度

**故事关联**
- 历史引用："你还记得上次闪电小狗的冒险吗？"
- 主题延续：优先推荐儿童喜欢的主题
- 避免重复：不重复已讲过的故事

#### 实现方式
- 使用向量数据库存储内容嵌入
- 相似度搜索找到相关历史记录
- 隐私保护：仅存储创作内容，不存储个人敏感信息

---

### 3.6 我的创作库 (My Library) [Not Started]

#### 功能描述
统一的内容库，儿童可以浏览、搜索、收藏和回顾所有创作成果：画作故事、互动叙事和儿童新闻。创作库根据年龄组自适应展示，像一个"个人魔法书架"，随着孩子的创作不断成长。

#### 用户场景
```
儿童打开"我的创作库"
  ↓
看到所有创作，默认按最新排序
  ↓
使用标签筛选类型（画作故事 / 互动故事 / 新闻）
  ↓
可选：按关键词搜索、按日期或收藏排序
  ↓
点击星标收藏最喜欢的故事
  ↓
点击卡片回顾故事，或点击音频图标直接在库中收听
  ↓
家长切换到"成长"视图查看创作时间线
```

#### 功能特性
- **统一浏览**: 所有内容类型在一个视图中，每种类型有专属卡片设计
- **搜索**: 故事文本、标题、主题、角色的全文搜索
- **收藏**: 书签/星标系统，快速访问最爱内容
- **排序**: 按日期（最新/最旧）和收藏优先排序
- **音频预览**: 直接在库卡片上播放故事音频，无需跳转
- **网格/列表切换**: 紧凑网格和详细列表视图间切换
- **年龄适配**: UI 复杂度随年龄组自适应
- **成长时间线**: 可视化图表展示创作频率随时间的变化

#### 年龄适配

| 年龄组 | 展示方式 |
|--------|---------|
| 3-5岁 | 大卡片布局（每行最多2个），突出的音频播放按钮，少文字，emoji标签，无搜索栏（家长可搜索），彩色背景 |
| 6-8岁 | 中等卡片（每行2-3个），搜索栏可见，简单排序下拉，星标收藏，主题标签可见 |
| 9-12岁 | 紧凑网格（每行3-4个），完整搜索+排序+筛选控件，字数统计和阅读数据可见，成长时间线可访问，列表/网格切换 |

#### 内容安全要求
- 库中仅显示已通过安全审查的内容（safety_score >= 0.85）
- 收藏/书签操作不需要重新安全检查（内容在创建时已检查）
- 搜索不暴露中间/归档状态的不安全内容——仅已发布/候选生命周期状态可查询

#### 验收标准
- [ ] 库显示所有三种内容类型（画作故事、互动会话、新闻），统一卡片设计
- [ ] 标签筛选正常工作："全部"、"画作故事"、"互动"、"新闻"
- [ ] 搜索输入可按标题、故事文本预览、主题和角色名筛选
- [ ] 排序选项："最新优先"（默认）、"最旧优先"、"收藏优先"
- [ ] 每个库卡片上有收藏/取消收藏切换，持久化到后端
- [ ] 网格视图切换（网格显示更大缩略图）
- [ ] 所有内容类型的分页（"加载更多"）
- [ ] 库卡片上的音频迷你播放器：点击播放/暂停，无需离开库
- [ ] 库 UI 年龄适配（3-5: 大卡片; 6-8: 均衡; 9-12: 紧凑网格+数据）
- [ ] 成长时间线视图（简单图表显示创作数量随时间变化）
- [ ] 已认证用户看服务端数据，未认证用户回退到本地存储

#### 不在本期范围
- 分享/社交功能（涉及隐私和 COPPA 合规）
- 合集/文件夹整理（Phase 3 考虑）
- 批量操作（保持对儿童简单）
- 完整家长分析仪表盘（Phase 3）
- 导出/下载为 PDF（Phase 3）

> **GitHub Epic**: #49 | **Phase**: MVP | **Milestone**: MVP — Core Story Flow

---

## 4. 用户旅程

### 4.1 首次使用

```
Step 1: 家长注册账号
  ↓
Step 2: 创建儿童档案（年龄、兴趣）
  ↓
Step 3: 儿童上传第一幅画作
  ↓
Step 4: AI 生成第一个故事
  ↓
Step 5: 儿童听故事（文字 + 语音）
  ↓
Step 6: 系统记录：画作内容、兴趣标签、互动反馈
```

### 4.2 日常使用

```
场景 A: 画作转故事
  儿童画画 → 上传 → 5-10秒生成 → 听故事

场景 B: 互动故事
  选择主题 → 开始故事 → 做选择 → 继续故事 → 结局（重复2-4轮）

场景 C: 新闻资讯（手动模式）
  家长分享新闻 → AI 转换 → 和孩子一起阅读 → 讨论问题

场景 D: 早间秀（自动模式）
  早上起床 → 打开"我的创作库" → 看到新节目 → 点击播放
  → 听好奇宝宝和趣味专家聊天 → 看到插画平移/缩放
  → 闪电小狗作为嘉宾出场 → 学到新知识
```

### 4.3 长期使用

```
Week 1: 创作 3 个故事，系统识别兴趣：动物、冒险
  ↓
Week 2: 系统推荐相关主题，儿童创作角色"闪电小狗"
  ↓
Week 3: 系统记住"闪电小狗"，在新故事中继续使用
  ↓
Week 4: 角色"成长"，闪电小狗学会了新技能
  ↓
Month 3: 儿童创作了 20+ 个故事，形成自己的"故事宇宙"
```

---

## 5. 功能优先级

### MVP (Minimum Viable Product) - 第一阶段

**必须有**:
- ✅ 画作转故事（基础功能）
- ✅ 线性故事生成
- ✅ 内容安全审查
- ✅ 语音朗读（TTS）
- ✅ 基础记忆（识别重复角色）
- 🔲 我的创作库（统一内容浏览、搜索、收藏）

### Phase 2 - 第二阶段

**应该有**:
- ✅ 互动故事生成（多分支）— 核心流程已完成，增强功能见 §3.2
- 🔲 互动故事增强（偏好感知生成、角色延续、会话恢复、故事回放）
- 🔲 儿童新闻早间秀（双角色对话播客 + 可视化动画 + 每日推送）— 见 §3.3
- 🔲 高级记忆（偏好追踪、故事关联、跨会话角色延续）
- 🔲 多种语音选择 + 多角色 TTS 编排
- 🔲 频道订阅系统（Daily Drop 自动生成）

### Phase 3 - 第三阶段

**可以有**:
- 动态绘本（画作元素动画）
- 视频生成（完整动画）
- 多语言支持
- 家长控制面板
- 激励勋章系统

---

## 6. 成功指标 (KPI)

### 使用指标
- **活跃度**: 儿童每周使用 3+ 次
- **完成率**: 互动故事完成率 > 80%
- **创作量**: 平均每用户每周创作 2+ 个故事

### 质量指标
- **家长满意度**: > 4.5/5.0
- **内容安全**: 不当内容通过率 < 0.1%
- **响应速度**: 故事生成 < 10 秒

### 教育效果
- **创造力**: 儿童主动创作频率提升 30%
- **阅读兴趣**: 阅读时长增加 50%
- **知识获取**: 能用自己的话解释新概念

---

## 7. 用户反馈与迭代

### 收集渠道
- 家长评分和评论
- 儿童互动行为分析（点击、完成率）
- A/B 测试不同故事风格

### 迭代方向
- 根据年龄段调整内容复杂度
- 优化互动分支设计
- 扩展兴趣主题库
- 改进安全审查准确性

---

## 8. 风险与限制

### 产品风险
- **内容质量**: AI 生成内容可能不够吸引人
  - 缓解：持续优化 Agent prompt，A/B 测试

- **安全漏洞**: AI 可能生成不当内容
  - 缓解：多层安全审查，人工抽检

- **隐私担忧**: 家长担心儿童数据安全
  - 缓解：符合 COPPA 标准，透明的隐私政策

### 技术限制
- **生成速度**: AI 生成需要 5-10 秒
  - 缓解：优化模型，使用流式输出

- **成本**: TTS 和 AI 调用成本较高
  - 缓解：缓存常用内容，批量处理

---

## 9. 竞品分析

### 现有产品

| 产品 | 特点 | 不足 |
|------|------|------|
| Story.com | AI 生成故事 | 无个性化，无记忆 |
| Storybird | 图片配文字 | 非 AI，需人工创作 |
| Epic! | 电子书库 | 被动阅读，无创作 |

### 我们的优势
- ✅ 基于儿童画作的个性化创作
- ✅ 记忆系统实现故事连续性
- ✅ 互动式多分支故事
- ✅ 严格的内容安全审查
- ✅ 教育目标融合

---

## 附录

### A. 相关文档
- [DOMAIN.md](./DOMAIN.md) - 领域背景和核心概念
- [ARCHITECTURE.md](../architecture/ARCHITECTURE.md) - 技术架构设计
- [DEVELOPMENT_WORKFLOW.md](../guides/DEVELOPMENT_WORKFLOW.md) - 开发工作流
- [README.md](../../README.md) - 项目简介和快速开始

### B. 参考标准
- COPPA (儿童在线隐私保护法)
- Common Core State Standards (分年龄阅读标准)
- ESRB Rating System (娱乐软件分级)
